<?xml version="1.0" encoding="utf-8"?>

<odoo>
	<data>
        <template id="car_diagnosys_temp_id">
			<t t-call="web.html_container">
				<t t-foreach="docs" t-as="doc">
					<t t-call="custom_bi_car_repair.car_diagnosys_template_view" />
				</t>
			</t>
		</template>
        <record id="car_diagnsys_report_id" model="ir.actions.report">
            <field name="name">imprimir OT</field>
            <field name="model">car.diagnosys</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">custom_bi_car_repair.car_diagnosys_temp_id</field>
            <field name="report_file">custom_bi_car_repair.car_diagnosys_temp_id</field>
            <field name="binding_type">report</field>
            <field name="binding_model_id" ref="model_car_diagnosys"/>

        </record>

		<template id="car_diagnosys_template_view">
			<t t-call="web.external_layout">
                <t t-set="o" t-value="doc.with_context({'lang':doc.partner_id.lang})"/>
                <div class="header" style="border: hidden;">
                    <header>
                        <div class="col-6">
                            <img t-if="o.car_repair_id.company_id.logo" t-att-src="image_data_uri(o.car_repair_id.company_id.logo)" style="max-height: 45px;" alt="Logo" />
                        </div>
                        
                    </header>
                </div>
				<div class="page">
                    <div class="row">
                        <div class="col-8" style="font-size:18px;">
                            <strong>ORDEN DE TRABAJO # <span t-field="o.car_repair_id.sequence" /></strong> 
                         </div>
                    </div>
                    <br/>
                   <div class="row">
                    <div class="col-8" >
                       <strong>Cliente</strong>
                       <br/>
                       Empresa: <span t-field="o.car_repair_id.partner_id.name" />
                       <br/>
                       RUT: <span t-field="o.car_repair_id.partner_id.vat" />
                       <br/>
                       Telefono: <span t-field="o.car_repair_id.partner_id.phone0" />
                       <br/>
                       Direccion: <span t-field="o.car_repair_id.partner_id.street" />
                    </div>
                    <div class="col-4">
                        <strong>
                            Veh√≠culo
                        </strong>
                        <br/>
                        <span t-field="o.car_repair_id.model" /> <span t-field="o.car_repair_id.brand" /> <span t-field="o.car_repair_id.year" />
                        <br/>
                        Matricula: <span t-field="o.car_repair_id.license_plate" />
                        <br/>
                        Color: <span t-field="o.car_repair_id.color" />
                        <br/>
                        Kilometraje: <span t-field="o.car_repair_id.fleet_id.odometer" />


                    </div>
                   </div>
                   <br/>
                   <div class="row">
                    <div class="col-8">
                        <strong>Falla:</strong> <span t-field="o.car_repair_id.problem" />
                        <br/>
                        <strong>Estado:</strong> <span t-field="o.car_repair_id.damage" />

                    </div>
                    <div class="col-4"></div>
                   </div>
                   <br/>
                   <br/>
                   <div class="row">
                    <table class="table">
                        <thead class="thead-light">
                        <tr>
                            <th>
                                Mano de obra
                            </th>
                            <th>
                                Cantidad
                            </th>
                            <th>
                                Valor
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="o.timesheet_ids" t-as="line">
                                <tr>
                                    <td>
                                        <span t-field="line.name"/>
                                    </td>
                                    <td>
                                        <span t-field="line.unit_amount"/> Hrs
                                    </td>
                                    <td>
                                       $ <span t-field="line.total_cost"/>
                                    </td>
                                </tr>

                            </t>
                            
                        </tbody>
                    </table>
                </div>
                <div class="row">
                    <table class="table">
                        <thead class="thead-light">
                        <tr>
                            <th>
                                Productos o repuestos
                            </th>
                            <th>
                                Cantidad
                            </th>
                            <th>
                                Valor
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                            <t t-foreach="o.car_repair_estimation_ids" t-as="lines">
                                <tr>
                                    <td>
                                        <span t-field="lines.product_id.name"/>
                                    </td>
                                    <td>
                                        <span t-field="lines.quantity"/>
                                    </td>
                                    <td>
                                       $ <span t-field="lines.price"/>
                                    </td>
                                </tr>

                            </t>
                            
                        </tbody>
                    </table>
                   </div>
                </div>
            </t>
        </template>
    </data>
</odoo>